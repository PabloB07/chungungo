{% extends "base.html" %}
{% block body %}

<div class="content">
	<h1>Enviar</h1>
	<h4>Tienes {{ balance[0]|round(8) }} CHA disponibles para transferir</h4>
</div>

<form action="/send" method="post">

<div class="field has-addons">
	<div class="control is-expanded has-icons-left">
		<input class="input is-large is-primary is-rounded" id="address" type="text" name="address" placeholder="DirecciÃ³n">
		<span class="icon is-left">
			<i class="far fa-user"></i>
		</span>
	</div>
	<div class="control">
		<div class="file is-primary is-rounded is-large">
		<label class="file-label">
		<input class="file-input" type=file accept="image/*" capture=environment onchange="openQRCamera(this);">
		<span class="file-cta">
			<span class="file-icon">
				<i class="fas fa-camera-retro"></i>
			</span>
			<span class="file-label">
				Leer QR
			</span>
		</span>
		</label>
		</div>
	</div>
</div>

<div class="field">
	<p class="control has-icons-left">
		<input class="input is-large is-primary is-rounded" type="text" name="amount" placeholder="Monto">
		<span class="icon is-left">
			<i class="fas fa-dollar-sign"></i>
		</span>
	</p>
</div>

<div class="field">
	<p class="control has-icons-left">
		<input class="input is-large is-primary is-rounded" type="text" name="msg" placeholder="Mensaje (Opcional)">
		<span class="icon is-left">
			<i class="far fa-smile"></i>
		</span>
	</p>
</div>
<div class="field">
	<p class="control">
		<div class="buttons is-right">
		<button class="button is-large is-primary is-rounded">
			<i class="fas fa-bullhorn"></i>
		</button>
		</div>
	</p>
</div>
</form>

<script type="text/javascript" src="{{ url_for('static', filename='qr_packed.js') }}"></script>

<script type="text/javascript">
function openQRCamera(node) {
  var reader = new FileReader();
  reader.onload = function() {
    node.value = "";
    qrcode.callback = function(res) {
      if(res instanceof Error) {
        alert("No QR code found. Please make sure the QR code is within the camera's frame and try again.");
      } else {
	    $('#address').attr('value', res);
      }
    };
    qrcode.decode(reader.result);
  };
  reader.readAsDataURL(node.files[0]);
}

</script>

{% endblock %}